# REST API

## Overview
The REST API provides HTTP endpoints for integrating the chatbot into web applications and other services. It includes session management, tool discovery, and health monitoring.

## Base URL
```
http://localhost:3000/api
```

## Endpoints

### 1. Chat Interaction

#### POST `/api/chat`
Send a message to the chatbot and receive a response.

**Request Body:**
```json
{
  "message": "What's the weather in Seoul?",
  "sessionId": "optional-session-id",
  "mode": "agent",
  "enableTools": true
}
```

**Response:**
```json
{
  "sessionId": "generated-or-provided-session-id",
  "message": "The weather in Seoul is currently clear with a temperature of 20Â°C and 55% humidity.",
  "mode": "agent",
  "tools": ["get_current_time", "calculate", "get_weather"],
  "history": 2
}
```

### 2. Session Management

#### GET `/api/chat/sessions/:id`
Get the conversation history for a specific session.

**Response:**
```json
{
  "sessionId": "session-123",
  "messages": [
    {
      "role": "user",
      "content": "Hello"
    },
    {
      "role": "assistant",
      "content": "Hello! How can I help you today?"
    }
  ],
  "createdAt": "2024-01-20T10:00:00.000Z",
  "lastActivity": "2024-01-20T10:05:00.000Z",
  "messageCount": 2
}
```

#### DELETE `/api/chat/sessions/:id`
Clear the conversation history for a specific session.

**Response:**
```json
{
  "success": true,
  "sessionId": "session-123",
  "message": "Session cleared"
}
```

#### POST `/api/chat/clear`
Alternative endpoint to clear the current session.

**Request Body:**
```json
{
  "sessionId": "session-123"
}
```

**Response:**
```json
{
  "success": true,
  "sessionId": "session-123",
  "message": "Chat history cleared"
}
```

### 3. Tools Discovery

#### GET `/api/tools`
List all available tools that the agent can use.

**Response:**
```json
{
  "tools": [
    {
      "name": "get_current_time",
      "description": "Get the current date and time in a specific timezone",
      "parameters": {
        "type": "object",
        "properties": {
          "timezone": {
            "type": "string",
            "description": "The timezone to get the time for",
            "default": "UTC"
          }
        },
        "required": [],
        "additionalProperties": false
      }
    },
    {
      "name": "calculate",
      "description": "Perform mathematical calculations",
      "parameters": {
        "type": "object",
        "properties": {
          "expression": {
            "type": "string",
            "description": "The mathematical expression to evaluate"
          }
        },
        "required": ["expression"],
        "additionalProperties": false
      }
    },
    {
      "name": "get_weather",
      "description": "Get weather information for a location",
      "parameters": {
        "type": "object",
        "properties": {
          "location": {
            "type": "string",
            "description": "The location to get weather for"
          }
        },
        "required": ["location"],
        "additionalProperties": false
      }
    }
  ],
  "count": 3
}
```

### 4. Health Check

#### GET `/api/health`
Check the server status and get basic statistics.

**Response:**
```json
{
  "status": "ok",
  "timestamp": "2024-01-20T10:00:00.000Z",
  "uptime": 3600,
  "sessions": {
    "active": 5,
    "total": 23
  },
  "memory": {
    "heapUsed": "45MB",
    "heapTotal": "128MB"
  }
}
```

## Error Responses

All endpoints return consistent error responses:

```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message",
    "timestamp": "2024-01-20T10:00:00.000Z",
    "path": "/api/chat"
  }
}
```

### Common Error Codes:
- `MISSING_MESSAGE` - No message provided in chat request
- `SESSION_NOT_FOUND` - Requested session doesn't exist
- `INTERNAL_ERROR` - Server-side error

## Session Management

- Sessions are created automatically on first request
- Session IDs can be provided by the client or generated by the server
- Sessions expire after 24 hours of inactivity
- Use cookies or headers to maintain session across requests

## CORS

The server has CORS enabled by default, allowing requests from any origin. In production, configure CORS appropriately:

```javascript
app.use(cors({
  origin: 'https://your-domain.com',
  credentials: true
}));
```

## Environment Variables

Configure the server using these environment variables:

- `PORT` - Server port (default: 3000)
- `SESSION_SECRET` - Secret for session encryption
- `NODE_ENV` - Environment (development/production)
- `OPENAI_API_KEY` - Required for agent mode

## Usage Examples

### Basic Chat Request
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "What time is it in New York?"
  }'
```

### With Session ID
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Calculate 123 * 456",
    "sessionId": "user-123"
  }'
```

### Get Session History
```bash
curl http://localhost:3000/api/chat/sessions/user-123
```

### Clear Session
```bash
curl -X DELETE http://localhost:3000/api/sessions/user-123
```